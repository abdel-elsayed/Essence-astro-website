---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { siteMeta } from '../../data/site';
import {
  services,
  servicesByDisplaySection,
  type ServiceItem
} from '../../data/services';

const sections = servicesByDisplaySection();

const sectionNotes: Record<string, string> = {
  'New Services': 'Fresh additions to the menu featuring regenerative technology and trending spa experiences.',
  'Most-Requested Treatments': 'Guest favorites that deliver luxurious results and an instant confidence boost.',
  'Facial Treatments': 'Advanced facials crafted to correct, protect, and elevate every skin type.',
  'Therapeutic Massage': 'Therapeutic bodywork that blends relaxation with targeted relief and rejuvenation.',
  Upgrades: 'Layer these enhancements onto any service to create your own bespoke spa day.',
  'Advanced Aesthetic': 'Regenerative and clinical treatments led by medical professionals for transformative results.',
  'Body Treatments': 'Head-to-toe rituals and jet plasma therapies that refine texture and tone.',
  'Brow & Lash': 'Finishing touches that frame the face with polished definition.',
  'Waxing Hair Removal Service': 'Expert hair removal for smooth, long-lasting confidence.'
};

const structuredData = services.map((service) => {
  const numericPrice = Number(service.price.replace(/[^0-9.]/g, ''));
  const hasValidPrice = Number.isFinite(numericPrice) && numericPrice > 0;

  const base: Record<string, unknown> = {
    '@context': 'https://schema.org',
    '@type': 'Service',
    name: service.title,
    description: service.excerpt,
    url: `${siteMeta.siteUrl}/services/${service.slug}`
  };

  if (hasValidPrice) {
    base.offers = {
      '@type': 'Offer',
      priceCurrency: 'USD',
      price: numericPrice,
      availability: 'https://schema.org/InStock'
    };
  }

  return base;
});

const formatPriceLabel = (price: string) => {
  if (!price) return '';
  return price.startsWith('$') || price.toLowerCase().startsWith('starting') ? price : `$${price}`;
};

const formatDuration = (service: ServiceItem) => service.duration ?? '';
---
<BaseLayout
  title="Services & Pricing | Essence Med Spa and Wellness Center"
  description="Explore medspa facials, injectables, and body rituals with transparent pricing, durations, and add-ons."
  structuredData={structuredData}
  currentPath="/services"
>
  <section class="bg-white pb-14 pt-16">
    <div class="container space-y-6">
      <p class="text-xs uppercase tracking-[0.4em] text-brand/80">Service Menu</p>
      <h1 class="font-display text-4xl text-neutral-900">Glow plans tailored to your skin story.</h1>
      <p class="max-w-2xl text-neutral-600">
        Each treatment includes a detailed consultation, clinical-grade products, and personalized at-home guidance. Prices below reflect starting rates; final investment is confirmed during your visit.
      </p>
      <div class="flex flex-wrap gap-3 text-sm text-neutral-600">
        {sections.map(({ label }) => (
          <a
            href={`#${label.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`}
            class="rounded-full border border-neutral-200 px-4 py-2 hover:border-brand-dark"
          >
            {label}
          </a>
        ))}
      </div>
    </div>
  </section>

  {sections.map(({ label, items }) => (
    <section id={label.toLowerCase().replace(/[^a-z0-9]+/g, '-')} class="bg-neutral-50 py-14">
      <div class="container space-y-8">
        <div class="space-y-3">
          <h2 class="font-display text-3xl text-neutral-900">{label}</h2>
          {sectionNotes[label] && <p class="max-w-2xl text-neutral-600">{sectionNotes[label]}</p>}
        </div>
        <div class="grid gap-8 xl:grid-cols-3">
          {items.map((service) => (
            <article class="flex h-full flex-col rounded-3xl border border-neutral-200 bg-white p-6 shadow-sm">
              <div class="space-y-3">
                <h3 class="text-xl font-semibold text-neutral-900">{service.title}</h3>
                {service.excerpt && <p class="text-sm text-neutral-600">{service.excerpt}</p>}
                {(service.price || service.duration) && (
                  <div class="flex flex-wrap items-center gap-3 text-sm text-neutral-700">
                    {service.price && (
                      <span class="rounded-full bg-brand/15 px-3 py-1 text-brand">
                        {formatPriceLabel(service.price)}
                      </span>
                    )}
                    {formatDuration(service) && <span>{formatDuration(service)}</span>}
                  </div>
                )}
                {service.highlights && service.highlights.length > 0 && (
                  <ul class="space-y-2 text-sm text-neutral-600">
                    {service.highlights.slice(0, 3).map((highlight) => (
                      <li class="flex gap-2">
                        <span class="mt-1 h-1.5 w-1.5 rounded-full bg-brand"></span>
                        <span>{highlight}</span>
                      </li>
                    ))}
                  </ul>
                )}
              </div>
              <div class="mt-auto pt-6">
                <a href={`/services/${service.slug}`} class="inline-flex items-center gap-2 text-sm font-semibold text-brand">
                  View details
                  <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M5 12h14" stroke-linecap="round"></path>
                    <path d="m13 6 6 6-6 6" stroke-linecap="round" stroke-linejoin="round"></path>
                  </svg>
                </a>
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>
  ))}

  <section class="bg-white py-16">
    <div class="container grid gap-8 rounded-3xl border border-neutral-200 bg-neutral-50 p-8 lg:grid-cols-[1fr_auto] lg:items-center">
      <div class="space-y-3">
        <h2 class="font-display text-2xl text-neutral-900">Unsure where to begin?</h2>
        <p class="text-neutral-600">
          Book a new guest skin consultation and weâ€™ll co-create a plan that may include a blend of facials, collagen therapy, and lymphatic bodywork.
        </p>
      </div>
      <a href="/book" class="rounded-xl bg-brand px-6 py-3 text-sm font-semibold text-white hover:bg-brand-dark">
        Book consultation
      </a>
    </div>
  </section>
</BaseLayout>
